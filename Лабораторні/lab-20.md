# 20. Паралельні обчислення за допомогою стандарту OpenMP ч.2

[Перелік усіх робіт](README.md)

## Мета роботи 

Ознайомитись із основними директивами OpenMP

## Обладнання

Персональний комп’ютер, Visual Studio 2008 або інша середа розробки для мови cpp

## Теоретичні відомості

### Загальний синтаксис виклику директив OpenMP 

Будь-які додаткові директиви викликаються за допомогою стандартної директиви `#pragma` і OpenMP не виняток. Отже, для того, щоб звернутися до директиви, потрібно написати `#pragma omp`, і назвати шукану директиву. Справедлива наступна конструкція виклику. 

```cpp
#pragma omp директива [опция1, опция2, ...]
```

Де директива — ім'я директиви, а опції є необов'язковим для виклику, їх у різних директив може бути різна кількість.

### Директива `parallel`

Найголовніша директива, служить до створення ниток(threads). Блок, який слідує за директивою, буде виконаний паралельно. Кількість новостворених ниток можна встановити за допомогою виклику функції `omp_set_num_threads()` передавши їй ціле число, що відповідає бажаній кількості. Дізнатись номер нитки в коді можна викликавши функцію `omp_get_thread_num()` 

> **Важливо!** Якщо написати вкладену директиву `parallel`, то кожна зі створених ниток, зустрівши директиву, створить ще таку кількість додаткових ниток, будьте уважні.

```cpp
#pragma omp parallel [опція1, опція2, ...]
{
    //блок
}
```

#### Опції:
`shared(змінні)` — у скобочках можна явно перерахувати список змінних, які будуть спільними для всіх ниток, хоча за замовчуванням усі змінні, оголошені до блоку такими є.
`private(змінні)` — у дужках можна вказати список змінних, які будуть приватними для кожної нитки.
`if(умова)` - перевірка умови, якщо true, то виконується директива, якщо false, то код виконується в колишньому режимі, без створення ниток. Можливо лише одна така опція на директиву. 

### Директива `for`

Використовується для явного розпаралелювання наступного циклу `for`, кожна кожна нитка почне зі свого індексу. Якщо не вказувати директиву, цикл буде пройдений кожною ниткою повністю від початку і до кінця 

```cpp
#pragma omp for [опція1, опція2]
for(int i = 0; i < 100; i++)
```

#### Опції:
`nowait` - опція дозволяє ниткам уникнути бар'єрної синхронізації в кінці циклу, яка виконується за умовчанням. 

### Директива `single`

Служить для того, щоб виконати якийсь блок у паралельній області лише один раз. Часто використовується для висновків, щоб лише одна нитка друкувала інформацію. 

```cpp
#pragma omp single
```

### Директива `master`

Аналогічна директиві `single`, але ми точно знаємо, що блок виконається майстер-ниткою. Майстром є та нитка, яка породила решту, її порядковий номер дорівнює 0. 

### Директива `critical`

Схожа на дві попередні. Різниця полягає в тому, що блок після директиви `critical` виконається **всіма нитками, але по черзі**. Якщо блок вже виконується будь-якою ниткою, всі інші блокуються на вході і чекають завершення. Після завершення роботи, випадково зі списку заблокованих вибирається нова. Таким чином одночасно блок буде виконуватися тільки однією ниткою. 

## Хід роботи

1. Завантажити Visual Studio 2008. Знайдіть на робочому столі ярлик з Visual Studio 2008 або Пуск → Всі програми→ Microsoft → Microsoft Visual Studio 2008.
2. Створити новий проект «Visual cpp (консольное приложение Win32)». Файл → Cтворити → Проект, тип проекту «Консольное приложение Win32».
3. Виконати завдання згідно варіанту. Виконати виміри часу вирішення завдання паралельним та послідовним варіантами програми.
    1. Протабулювати функцію на заданому відрізку із заданим кроком. 
    2. Виконати додавання двох матриць однакового розміру. 
    3. Знайти суму максимальних елементів рядків матриці.
    4. Знайти площу опуклого багатокутника, заданого координатами вершин. 
    5. Знайти у цьому тексті все паліндроми.
    6. Знайти у тексті всі входження даного зразка.
    7. Дано послідовність дійсних чисел. Скоротити кількість десяткових розрядів після коми кожного числа до двох. 
    8. Дано послідовність арифметичних виразів, операндами яких є однозначні числа, а число операцій не більше двох. Знайти значення всіх виразів.
    9. Дано матрицю речових чисел. Перетворити матрицю таким чином, щоб елементи її рядків йшли за спаданням.
    10. Вивести всі приголосні, які відсутні у цьому тексті. 


## Контрольні запитання

1. Опишіть директиву `paralel`.
2. Чим відрізняється директиви `single`, `master` та `critical`?
3. Як визначити ділянку коду, яку повинен виконувати тільки один потік в OpenMP?
4. Які функції використовуються для забезпечення атомарності операцій в OpenMP?
5. Як використовувати `private` змінні в OpenMP?
6. Які директиви використовуються для побудови паралельних циклів в OpenMP?
7. Які функції використовуються для розподілу даних між потоками в OpenMP?
8. Які директиви використовуються для розподілу завдань між потоками в OpenMP?
9. Які директиви використовуються для побудови паралельних секцій в OpenMP?
10. Як використовувати task змінні в OpenMP?

## Довідники та додаткові матеріали

1.  [OpenMP official website](https://www.openmp.org/)
2.  [OpenMP API Specification 5.1](https://www.openmp.org/wp-content/uploads/OpenMP-API-Specification-5.1.pdf)
3.  [OpenMP Language Specification on Microsoft Docs](https://docs.microsoft.com/en-us/cpp/parallel/openmp/reference/openmp-language-specification?view=msvc-160)
4.  [libgomp documentation (GCC implementation of OpenMP)](https://gcc.gnu.org/onlinedocs/libgomp/index.html#Top)
5.  [OpenMP support in Intel Threading Building Blocks](https://software.intel.com/content/www/us/en/develop/documentation/tbb-documentation/top/intel-threading-building-blocks-developer-reference-c/openmp-support/openmp-support-in-tbb.html)
6.  [OpenMP Tutorials and Articles](https://www.openmp.org/resources/tutorials-articles/)
7.  [Books on OpenMP](https://www.openmp.org/resources/books-3/)
8.  [Офіційний веб-сайт OpenMP](https://www.openmp.org/uk/)
9.  [Специфікація API OpenMP 5.1](https://www.openmp.org/wp-content/uploads/OpenMP-API-Specification-5.1.pdf)
10. [Специфікація мови OpenMP на Microsoft Docs](https://docs.microsoft.com/uk-ua/cpp/parallel/openmp/reference/openmp-language-specification?view=msvc-160)
11. [Документація libgomp (реалізація OpenMP в GCC)](https://gcc.gnu.org/onlinedocs/libgomp/index.html#Top)
12. [Підтримка OpenMP в Intel Threading Building Blocks](https://software.intel.com/content/www/us/en/develop/documentation/tbb-documentation/top/intel-threading-building-blocks-developer-reference-c/openmp-support/openmp-support-in-tbb.html)
13. [Навчальні матеріали та статті про OpenMP](https://www.openmp.org/resources/tutorials-articles/)
14. [Книги про OpenMP](https://www.openmp.org/resources/books-3/)
