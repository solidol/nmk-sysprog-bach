# 15. Робота з файлами за допомогою засобів WinAPI32

[Перелік усіх робіт](README.md)

## Мета роботи 

Навчитися створювати та оброблювати файли за допомогою засобів WinAPI32

## Обладнання

Персональний комп’ютер, Visual Studio 2008 або інша середа розробки для мови C++

## Теоретичні відомості

### Загальне про WinAPI

WinAPI (Windows API) - це набір функцій і інтерфейсів програмування, що надаються операційною системою Windows для розробки додатків для цієї платформи.

Основні можливості WinAPI включають:

1. Керування вікнами та ресурсами: WinAPI надає можливості для створення вікон, керування їх властивостями (розмір, положення, стиль тощо) та взаємодії з користувачем за допомогою різних контролів, таких як кнопки, поле введення тощо.

2. Робота з файлами і директоріями: WinAPI надає можливості для створення, відкриття, закриття, копіювання, переміщення, видалення файлів та директорій, а також для роботи зі шляхами до файлів.

3. Мережеве програмування: WinAPI дозволяє створювати програми, які взаємодіють з мережею, включаючи можливість створення мережевих з'єднань, передачі даних, з'єднання з серверами тощо.

4. Робота зі системними ресурсами: WinAPI надає можливості для керування системними ресурсами, такими як реєстр Windows, служби Windows, процеси і потоки, пристрої вводу/виводу тощо.

5. Графіка та зображення: WinAPI дозволяє створювати графічні елементи і обробляти зображення, включаючи можливості створення малюнків, зображень, зображень з прозорістю, а також робота з форматами зображень (BMP, JPEG, PNG тощо).

6. Криптографія та безпека: WinAPI надає можливості для криптографічного захисту даних, включаючи можливості для шифрування, розшифрування, хешування, підписування та перевірки цифрових підписів, а також для роботи з сертифікатами безпеки.

7. Міжпроцесова взаємодія: WinAPI дозволяє створювати програми, які взаємодіють між собою через міжпроцесову взаємодію, включаючи можливості для створення іменованих каналів, сокетів, повідомлень тощо.

8. Мультипоточність: WinAPI дозволяє створювати програми з мультипоточним виконанням, включаючи можливості для створення потоків, синхронізації доступу до ресурсів, забезпечення безпеки виконання тощо.

9. Звук та мультимедіа: WinAPI дозволяє створювати програми, які взаємодіють зі звуком та мультимедіа, включаючи можливості для відтворення аудіо та відео, керування звуковими пристроями, захоплення відео тощо.

10. Взаємодія з іншими сервісами та додатками: WinAPI надає можливості для взаємодії з іншими сервісами та додатками, включаючи можливості для роботи зі скриншотами, віртуальною клавіатурою, системними подіями та повідомленнями, друком документів тощо.

### WinAPI і робота з файлами

WinAPI містить декілька функцій для роботи з файлами, основні з яких:

1. CreateFile: функція створює або відкриває файл і повертає дескриптор файлу, який потім може використовуватися для доступу до файлу.

2. ReadFile: функція читає дані з файлу в буфер.

3. WriteFile: функція записує дані з буфера в файл.

4. SetFilePointer: функція встановлює позицію файлу, яка використовується для наступних операцій зчитування або запису.

5. GetFileSize: функція повертає розмір файлу в байтах.

6. CloseHandle: функція закриває дескриптор файлу.

7. DeleteFile: функція видаляє файл з файлової системи.

8. MoveFile: функція переміщує або перейменовує файл.

9. CopyFile: функція копіює файл.

10. GetFileAttributes: функція повертає атрибути файлу, такі як режим доступу, час створення, час модифікації тощо.

11. FindFirstFile і FindNextFile: функції використовуються для пошуку файлів у директорії за допомогою маски імені файлу.

Ці функції дозволяють програмістам створювати, читати, записувати, переміщувати, перейменовувати та видаляти файли, а також отримувати інформацію про них. Завдяки WinAPI можна працювати з різними типами файлів, включаючи текстові файли, бінарні файли, файли зображень тощо.

Приклад програми запису у файл та читання з файлу:


```cpp
#include <iostream>
#include <windows.h>

using namespace std;

int main()
{
    SetConsoleCP(65001);
    SetConsoleOutputCP(65001);
    HANDLE hFile;
    DWORD dwBytesWritten, dwBytesRead;
    char szBuffer[256] = "Hello World!";
    char szReadBuffer[256] = "";

    // Відкриття файлу
    hFile = CreateFile("c:\\test.txt", GENERIC_WRITE, 0, NULL, CREATE_ALWAYS, FILE_ATTRIBUTE_NORMAL, NULL);
    if (hFile == INVALID_HANDLE_VALUE)
    {
        cout << "Помилка відкриття файлу!" << endl;
        return 1;
    }

    // Запис до файлу
    if (!WriteFile(hFile, szBuffer, strlen(szBuffer), &dwBytesWritten, NULL))
    {
        cout << "Помилка запису до файлу!" << endl;
        CloseHandle(hFile);
        return 1;
    }

    cout << "Записано в файл: " << dwBytesWritten << " байт" << endl;

    // Закриття файлу
    CloseHandle(hFile);

    // Відкриття файлу для читання
    hFile = CreateFile("c:\\test.txt", GENERIC_READ, 0, NULL, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, NULL);
    if (hFile == INVALID_HANDLE_VALUE)
    {
        cout << "Помилка відкриття файлу!" << endl;
        return 1;
    }

    // Читання з файлу
    if (!ReadFile(hFile, szReadBuffer, sizeof(szReadBuffer), &dwBytesRead, NULL))
    {
        cout << "Помилка читання з файлу!" << endl;
        CloseHandle(hFile);
        return 1;
    }

    cout << "Прочитано з файлу: " << szReadBuffer << endl;

    // Закриття файлу
    CloseHandle(hFile);

    return 0;
}
```

У цій програмі спочатку відкривається файл "test.txt" для запису і записується рядок "Hello World!" до файлу. Потім файл закривається і відкривається для читання. Прочитаний рядок зберігається в змінну і виводиться на екран.

Приклад програми для копіювання файлу:

```cpp
#include <iostream>
#include <windows.h>

using namespace std;

int main() {
    // Вхідний та вихідний файли
    LPCWSTR inputFile = L"C:\\input.txt";
    LPCWSTR outputFile = L"C:\\output.txt";

    // Копіюємо вміст вхідного файлу у вихідний файл
    if (CopyFile(inputFile, outputFile, FALSE)) {
        cout << "Файл успішно скопійовано!" << endl;
    } else {
        cout << "Не вдалося скопіювати файл!" << endl;
    }

    return 0;
}
```

Ця програма використовує функцію CopyFile, яка копіює вміст одного файлу в інший файл. Перший параметр цієї функції - це шлях до вхідного файлу, другий параметр - це шлях до вихідного файлу. Третій параметр - це флаг, який вказує, чи потрібно замінювати вихідний файл, якщо він вже існує. У цьому прикладі флаг встановлено в FALSE, щоб вихідний файл не замінявся, якщо він вже існує. Після завершення копіювання функція повертає TRUE, якщо копіювання пройшло успішно, або FALSE, якщо виникла помилка.

## Хід роботи

1. Завантажити Visual Studio 2008. Знайдіть на робочому столі ярлик з Visual Studio 2008 або Пуск → Всі програми→ Microsoft → Microsoft Visual Studio 2008.

2. Створити новий проект «Visual C++ (консольное приложение Win32)». Файл → Cтворити → Проект, тип проекту «Консольное приложение Win32».

3. Розв'язати задачу згідно з варіантом, використовуючи функції бібліотеки `windows`.

	1. Записати в файл C:\file.txt таблицю множення числа 5.
	2. Записати в файл C:\file.txt 10 чисел, що вводяться з клавіатури.
	3. Записати в файл C:\file.txt таблицю ділення числа 100.
	4. Записати в файл C:\file.txt таблицю множення числа 3.
	5. Записати в файл C:\file.txt 10 випадкових чисел.
   
4. Розв'язати задачу згідно з варіантом, використовуючи функції бібліотеки `windows`.

	1. Знайти суму чисел з файлу C:\file.txt.
	2. Знайти мінімальне число з файлу C:\file.txt.
	3. Знайти середнє значення чисел з файлу C:\file.txt.
	4. Знайти добуток чисел з файлу C:\file.txt.
	5. Знайти максимальне число з файлу C:\file.txt.

5. Написати програму, яка створює каталог на диску С та переміщує туди файл створений у попередньому завданні
   
6. Скласти звіт про роботу та відповісти на контрольні питання. Додати у звіт код програм, намалювати блоксхеми

7. Зберегти звіт у форматі PDF та надати викладачеві на перевірку.

## Контрольні питання

1. Які функції WinAPI можна використовувати для роботи з файлами в C++?
2. Які типи даних використовуються для представлення файлових дескрипторів в WinAPI?
3. Як можна відкрити файл за допомогою функції CreateFile в WinAPI?
4. Які функції WinAPI можна використовувати для читання даних з файлу?
5. Як можна записати дані в файл за допомогою функції WriteFile в WinAPI?
6. Як можна дізнатися розмір файлу за допомогою функції GetFileSize в WinAPI?
7. Як можна перевірити наявність файлу за допомогою функції GetFileAttributes в WinAPI?
8. Як можна видалити файл за допомогою функції DeleteFile в WinAPI?
9. Як можна перейменувати файл за допомогою функції MoveFile в WinAPI?
10. Як можна скопіювати файл за допомогою функції CopyFile в WinAPI?

## Довідники та додаткові матеріали

1. [Windows API: функція CreateFile](https://docs.microsoft.com/uk-ua/windows/win32/api/fileapi/nf-fileapi-createfilea)
3. [Windows API: функція ReadFile](https://docs.microsoft.com/uk-ua/windows/win32/api/fileapi/nf-fileapi-readfile)
4. [Windows API: функція WriteFile](https://docs.microsoft.com/uk-ua/windows/win32/api/fileapi/nf-fileapi-writefile)
5. [Windows API: функція SetFilePointer](https://docs.microsoft.com/uk-ua/windows/win32/api/fileapi/nf-fileapi-setfilepointer)
6.  [Windows API: функція CloseHandle](https://docs.microsoft.com/uk-ua/windows/win32/api/handleapi/nf-handleapi-closehandle)
7. [File Management Functions - Win32 apps | Microsoft Docs](https://docs.microsoft.com/en-us/windows/win32/fileio/file-management-functions)
2. [File Access Rights and Permissions - Win32 apps | Microsoft Docs](https://docs.microsoft.com/en-us/windows/win32/secauthz/file-access-rights-and-permissions)
3. [File I/O - Win32 apps | Microsoft Docs](https://docs.microsoft.com/en-us/windows/win32/fileio/file-i-o)
4. [File Mapping - Win32 apps | Microsoft Docs](https://docs.microsoft.com/en-us/windows/win32/memory/file-mapping)
5. [File Time - Win32 apps | Microsoft Docs](https://docs.microsoft.com/en-us/windows/win32/sysinfo/file-time)
6. [Функції управління файлами - Win32 apps | Microsoft Docs](https://docs.microsoft.com/uk-ua/windows/win32/fileio/file-management-functions)
7. [Права доступу та дозволи для файлів - Win32 apps | Microsoft Docs](https://docs.microsoft.com/uk-ua/windows/win32/secauthz/file-access-rights-and-permissions)
8. [Введення-виведення файлів - Win32 apps | Microsoft Docs](https://docs.microsoft.com/uk-ua/windows/win32/fileio/file-i-o)


